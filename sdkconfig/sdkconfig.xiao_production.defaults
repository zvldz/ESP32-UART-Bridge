# XIAO PRODUCTION 

# BASE
CONFIG_AUTOSTART_ARDUINO=y
CONFIG_FREERTOS_UNICORE=n
CONFIG_FREERTOS_HZ=1000

# USB Configuration
CONFIG_TINYUSB_ENABLED=y
CONFIG_TINYUSB_HOST_ENABLED=y
CONFIG_TINYUSB_HOST_MODE_FULL_SPEED=y

# USB Host Class drivers
CONFIG_TINYUSB_HOST_HUB=y
CONFIG_TINYUSB_HOST_HID=y
CONFIG_TINYUSB_HOST_MSC=y
CONFIG_TINYUSB_HOST_CDC=y

# USB Host Configuration
CONFIG_TINYUSB_HOST_DEVICE_MAX=4

# Debug level
CONFIG_TINYUSB_DEBUG_LEVEL=0

# USB Host settings
CONFIG_USB_HOST_CONTROL_TRANSFER_MAX_SIZE=256
CONFIG_USB_HOST_DEBOUNCE_DELAY_MS=150
CONFIG_USB_HOST_RESET_RECOVERY_MS=100
CONFIG_USB_HOST_SET_ADDR_RECOVERY_MS=100

# PSRAM
CONFIG_SPIRAM=y
CONFIG_SPIRAM_MODE_OCT=y
CONFIG_SPIRAM_USE_MALLOC=y
CONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY=y

CONFIG_ESPTOOLPY_FLASHSIZE="4MB"
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y

# Bootloader
CONFIG_BOOTLOADER_LOG_LEVEL_NONE=y
CONFIG_BOOTLOADER_LOG_LEVEL=0
CONFIG_BOOT_ROM_LOG_ALWAYS_OFF=y

# Runtime logs - NONE for production (prevents ESP_LOG interfering with USB data)
CONFIG_LOG_DEFAULT_LEVEL_NONE=y
CONFIG_LOG_DEFAULT_LEVEL=0

# Core Dump to Flash
CONFIG_ESP_COREDUMP_TO_FLASH_OR_UART=y
# CONFIG_ESP_COREDUMP_ENABLE_TO_NONE is not set
# CONFIG_ESP_COREDUMP_ENABLE_TO_UART is not set
CONFIG_ESP_COREDUMP_ENABLE_TO_FLASH=y
CONFIG_ESP_COREDUMP_DATA_FORMAT_ELF=y
CONFIG_ESP_COREDUMP_CHECKSUM_CRC32=y
CONFIG_ESP_COREDUMP_MAX_TASKS_NUM=64

# UART DMA support
CONFIG_UART_ISR_IN_IRAM=y
#CONFIG_UART_RX_BUFFER_SIZE=8192

# WiFi
CONFIG_ESP32_WIFI_ENABLED=y

#CONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=8    # Base RX pool (Ignored when RX_BUFFER_TYPE=1)
#CONFIG_ESP32_WIFI_STATIC_TX_BUFFER_NUM=8    # Base TX pool (Ignored when TX_BUFFER_TYPE=1)
#CONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=16  # Additional RX buffers on demand
#CONFIG_ESP32_WIFI_DYNAMIC_TX_BUFFER_NUM=24  # TX buffers for burst traffic
#CONFIG_ESP32_WIFI_RX_BUFFER_TYPE=2          # Hybrid mode (static + dynamic)
#CONFIG_ESP32_WIFI_TX_BUFFER_TYPE=1          # Dynamic only for flexibility

CONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=10     # Static RX buffers allocated at boot (never freed)
CONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=16    # Dynamic RX buffers (0=disabled, prevents fragmentation)
CONFIG_ESP32_WIFI_STATIC_TX_BUFFER_NUM=8      # Static TX buffers allocated at boot (never freed)
CONFIG_ESP32_WIFI_DYNAMIC_TX_BUFFER_NUM=8     # Dynamic TX buffers (0=disabled, prevents fragmention)
CONFIG_ESP32_WIFI_RX_BUFFER_TYPE=2            # RX allocation: 0=Static only, 1=Dynamic, 2=Hybrid
CONFIG_ESP32_WIFI_TX_BUFFER_TYPE=2            # TX allocation: 0=Static only, 1=Dynamic

CONFIG_ESP_WIFI_STA_SLEEP_ENABLE=n          # No sleep for low latency
CONFIG_ESP32_WIFI_PS_NONE=y                 # Power save disabled
CONFIG_ESP32_WIFI_PS_MIN_MODEM=n            # Minimum modem sleep disabled
CONFIG_ESP32_WIFI_PS_MAX_MODEM=n            # Maximum modem sleep disabled
CONFIG_ESP32_WIFI_AMPDU_TX_ENABLED=y        # TX aggregation for throughput
CONFIG_ESP32_WIFI_AMPDU_RX_ENABLED=y        # RX aggregation for throughput
CONFIG_ESP32_WIFI_RX_BA_WIN=16              # RX block ACK window size
CONFIG_ESP32_WIFI_IRAM_OPT=y                # WiFi critical code in IRAM
CONFIG_ESP32_WIFI_RX_IRAM_OPT=y             # RX path in IRAM for low latency

# Move WiFi task to Core 1 (away from UART on Core 0)
#CONFIG_ESP_WIFI_TASK_PINNED_TO_CORE_0=n
#CONFIG_ESP_WIFI_TASK_PINNED_TO_CORE_1=y

# UART Driver
CONFIG_UART_ENABLED=y
CONFIG_UART_ISR_IN_IRAM=y

# GPIO Driver
CONFIG_GPIO_ENABLED=y

# Timer Driver  
CONFIG_TIMER_ENABLED=y

# SPI Master (for flash)
CONFIG_SPI_MASTER_ENABLED=y
CONFIG_SPI_MASTER_ISR_IN_IRAM=y

# Enable mDNS for Client mode device discovery
CONFIG_MDNS_ENABLED=y
CONFIG_MDNS_TASK_PRIORITY=5                 # EXPERIMENTAL: default=1 too low, mDNS misses queries under load

# LWIP - Memory optimization for web interface
# IPv6 not needed
# CONFIG_LWIP_IPV6=y
CONFIG_LWIP_IPV6=n
CONFIG_LWIP_IPV6_NUM_ADDRESSES=0
CONFIG_LWIP_MLDV6_TMR_INTERVAL=0

# Sockets / TCP limits (web only, async server):
# CONFIG_LWIP_MAX_SOCKETS=10
CONFIG_LWIP_MAX_SOCKETS=8
# CONFIG_LWIP_MAX_ACTIVE_TCP=16
CONFIG_LWIP_MAX_ACTIVE_TCP=8
# CONFIG_LWIP_MAX_LISTENING_TCP=16
CONFIG_LWIP_MAX_LISTENING_TCP=4

# TCP window/buffers (smaller, fine for gz+short JSON):
# CONFIG_LWIP_TCP_SND_BUF_DEFAULT=5760
CONFIG_LWIP_TCP_SND_BUF_DEFAULT=2920
# CONFIG_LWIP_TCP_WND_DEFAULT=5760
CONFIG_LWIP_TCP_WND_DEFAULT=2920
# CONFIG_LWIP_TCPIP_RECVMBOX_SIZE=32
CONFIG_LWIP_TCPIP_RECVMBOX_SIZE=16

# UDP settings are left as-is (AsyncUDP may be active):
# CONFIG_LWIP_MAX_UDP_PCBS=16 (unchanged)
# CONFIG_LWIP_UDP_RECVMBOX_SIZE=6 (unchanged)

# LittleFS
CONFIG_LITTLEFS_ENABLED=y

# Compiler
CONFIG_COMPILER_OPTIMIZATION_PERF=y
#CONFIG_COMPILER_OPTIMIZATION_SIZE=y
#CONFIG_COMPILER_OPTIMIZATION_ASSERTIONS_DISABLE=y
#CONFIG_COMPILER_WARN_WRITE_STRINGS=n

CONFIG_ETH_ENABLED=n

CONFIG_IDF_COMPONENT_MANAGER=n

# Disable mbedTLS (not used in UART bridge)
CONFIG_MBEDTLS_ENABLED=n

# Disable OpenSSL
CONFIG_OPENSSL_ASSERT_DO_NOTHING=y

# Disable ESP-TLS
CONFIG_ESP_TLS_USING_MBEDTLS=n

# Disable Zigbee and Thread
CONFIG_ZB_ENABLED=n
CONFIG_OPENTHREAD_ENABLED=n
CONFIG_IEEE802154_ENABLED=n

# Disable Bluetooth completely
CONFIG_BT_ENABLED=n
CONFIG_BLUEDROID_ENABLED=n
CONFIG_BT_NIMBLE_ENABLED=n

# Disable Ethernet
CONFIG_ETH_ENABLED=n

# Disable SPI Flash encryption/security
CONFIG_SECURE_FLASH_ENC_ENABLED=n
CONFIG_SECURE_BOOT=n
CONFIG_SECURE_BOOT_SIGNED_BINARIES=n
CONFIG_SECURE_BOOT_BUILD_SIGNED_BINARIES=n

# Disable file systems we don't use
CONFIG_SPIFFS_ENABLED=n
CONFIG_FATFS_ENABLED=n

# Disable unused app protocols
CONFIG_ESP_HTTP_CLIENT_ENABLE=n
CONFIG_ESP_HTTP_SERVER_ENABLE=n
CONFIG_ESP_WEBSOCKET_CLIENT_ENABLE=n
CONFIG_MQTT_ENABLED=n
CONFIG_COAP_ENABLED=n
