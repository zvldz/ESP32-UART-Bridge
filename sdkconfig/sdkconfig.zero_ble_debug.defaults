# ZERO BLE Debug (ESP32-S3 with BLE)

# BASE
CONFIG_AUTOSTART_ARDUINO=y
CONFIG_FREERTOS_UNICORE=n
CONFIG_FREERTOS_HZ=1000

# USB Configuration
CONFIG_TINYUSB_ENABLED=y
CONFIG_TINYUSB_HOST_ENABLED=y
CONFIG_TINYUSB_HOST_MODE_FULL_SPEED=y

# USB Host Class drivers
CONFIG_TINYUSB_HOST_HUB=y
CONFIG_TINYUSB_HOST_HID=y
CONFIG_TINYUSB_HOST_MSC=y
CONFIG_TINYUSB_HOST_CDC=y

# USB Host Configuration
CONFIG_TINYUSB_HOST_DEVICE_MAX=4

# Debug level
CONFIG_TINYUSB_DEBUG_LEVEL=1

# USB Host settings
CONFIG_USB_HOST_CONTROL_TRANSFER_MAX_SIZE=256
CONFIG_USB_HOST_DEBOUNCE_DELAY_MS=150
CONFIG_USB_HOST_RESET_RECOVERY_MS=100
CONFIG_USB_HOST_SET_ADDR_RECOVERY_MS=100

# PSRAM
CONFIG_SPIRAM=y
CONFIG_SPIRAM_USE_MALLOC=y
CONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY=y

CONFIG_ESPTOOLPY_FLASHSIZE="4MB"
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y

# EXTRA LOGS FOR DEBUGGING PANICS
CONFIG_LOG_DEFAULT_LEVEL_WARN=y
CONFIG_LOG_DEFAULT_LEVEL=2

# Bootloader
CONFIG_BOOTLOADER_LOG_LEVEL_NONE=y
CONFIG_BOOTLOADER_LOG_LEVEL=0
CONFIG_BOOT_ROM_LOG_ALWAYS_OFF=y

# Core Dump to Flash
CONFIG_ESP_COREDUMP_TO_FLASH_OR_UART=y
# CONFIG_ESP_COREDUMP_ENABLE_TO_NONE is not set
# CONFIG_ESP_COREDUMP_ENABLE_TO_UART is not set
CONFIG_ESP_COREDUMP_ENABLE_TO_FLASH=y
CONFIG_ESP_COREDUMP_DATA_FORMAT_ELF=y
CONFIG_ESP_COREDUMP_CHECKSUM_CRC32=y
CONFIG_ESP_COREDUMP_MAX_TASKS_NUM=64

# UART DMA support
CONFIG_UART_ISR_IN_IRAM=y

# System event task stack (default 2304 is too small with log_msg stack buffers)
CONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=3072

# WiFi
CONFIG_ESP32_WIFI_ENABLED=y
CONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=10
CONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=16
CONFIG_ESP32_WIFI_STATIC_TX_BUFFER_NUM=8
CONFIG_ESP32_WIFI_DYNAMIC_TX_BUFFER_NUM=8
CONFIG_ESP32_WIFI_RX_BUFFER_TYPE=2
CONFIG_ESP32_WIFI_TX_BUFFER_TYPE=2
# Modem sleep disabled for debug (production uses MIN_MODEM for BLE coexistence)
CONFIG_ESP_WIFI_STA_SLEEP_ENABLE=n
CONFIG_ESP32_WIFI_PS_NONE=y
CONFIG_ESP32_WIFI_PS_MIN_MODEM=n
CONFIG_ESP32_WIFI_PS_MAX_MODEM=n
CONFIG_ESP32_WIFI_AMPDU_TX_ENABLED=y
CONFIG_ESP32_WIFI_AMPDU_RX_ENABLED=y
CONFIG_ESP32_WIFI_RX_BA_WIN=16
CONFIG_ESP32_WIFI_IRAM_OPT=y
CONFIG_ESP32_WIFI_RX_IRAM_OPT=y

# UART Driver
CONFIG_UART_ENABLED=y
CONFIG_UART_ISR_IN_IRAM=y

# GPIO Driver
CONFIG_GPIO_ENABLED=y

# Timer Driver
CONFIG_TIMER_ENABLED=y

# SPI Master (for flash)
CONFIG_SPI_MASTER_ENABLED=y
CONFIG_SPI_MASTER_ISR_IN_IRAM=y

# Enable mDNS for Client mode device discovery
CONFIG_MDNS_ENABLED=y
CONFIG_MDNS_TASK_PRIORITY=5

# LWIP - Memory optimization for web interface
CONFIG_LWIP_IPV6=n
CONFIG_LWIP_IPV6_NUM_ADDRESSES=0
CONFIG_LWIP_MLDV6_TMR_INTERVAL=0
CONFIG_LWIP_MAX_SOCKETS=8
CONFIG_LWIP_MAX_ACTIVE_TCP=8
CONFIG_LWIP_MAX_LISTENING_TCP=4
CONFIG_LWIP_TCP_SND_BUF_DEFAULT=2920
CONFIG_LWIP_TCP_WND_DEFAULT=2920
CONFIG_LWIP_TCPIP_RECVMBOX_SIZE=16

# LittleFS
CONFIG_LITTLEFS_ENABLED=y

# Compiler
CONFIG_COMPILER_OPTIMIZATION_PERF=y

CONFIG_ETH_ENABLED=n
CONFIG_IDF_COMPONENT_MANAGER=n

# mbedTLS required for WiFi WPA2 encryption
# Note: Cannot disable when WiFi + BLE coexist (GDMA channel conflict)
CONFIG_MBEDTLS_ENABLED=y

# Disable OpenSSL
CONFIG_OPENSSL_ASSERT_DO_NOTHING=y

# Disable Zigbee and Thread
CONFIG_ZB_ENABLED=n
CONFIG_OPENTHREAD_ENABLED=n
CONFIG_IEEE802154_ENABLED=n

# BLE using ESP-IDF NimBLE component (lightweight BLE stack)
CONFIG_BT_ENABLED=y
CONFIG_BT_NIMBLE_ENABLED=y
CONFIG_BLUEDROID_ENABLED=n
# NimBLE configuration - peripheral only (we are the server)
CONFIG_BT_NIMBLE_ROLE_PERIPHERAL=y
CONFIG_BT_NIMBLE_ROLE_CENTRAL=n
CONFIG_BT_NIMBLE_ROLE_BROADCASTER=y
CONFIG_BT_NIMBLE_ROLE_OBSERVER=n
# BLE connection settings
CONFIG_BT_NIMBLE_MAX_CONNECTIONS=1
CONFIG_BT_NIMBLE_MAX_BONDS=10
CONFIG_BT_NIMBLE_NVS_PERSIST=y
CONFIG_BT_NIMBLE_MAX_CCCDS=8
CONFIG_BT_NIMBLE_L2CAP_COC_MAX_NUM=0
# Buffer sizes (optimized for NUS)
CONFIG_BT_NIMBLE_ATT_PREFERRED_MTU=256
CONFIG_BT_NIMBLE_ACL_BUF_COUNT=12
CONFIG_BT_NIMBLE_ACL_BUF_SIZE=255
CONFIG_BT_NIMBLE_HCI_EVT_BUF_SIZE=70
CONFIG_BT_NIMBLE_HCI_EVT_HI_BUF_COUNT=8
CONFIG_BT_NIMBLE_HCI_EVT_LO_BUF_COUNT=8
# GAP settings
CONFIG_BT_NIMBLE_SVC_GAP_DEVICE_NAME="ESP-Bridge"
CONFIG_BT_NIMBLE_GAP_DEVICE_NAME_MAX_LEN=31
CONFIG_BT_NIMBLE_SVC_GAP_APPEARANCE=0
CONFIG_BT_NIMBLE_GATT_MAX_PROCS=4
# Disable extended advertising (BLE 5.0 feature we don't need)
CONFIG_BT_NIMBLE_EXT_ADV=n
# Memory allocation - default (production uses INTERNAL only)
# CONFIG_BT_NIMBLE_MEM_ALLOC_MODE_INTERNAL=y
# Task stack size (4096 required for active notify transmission)
CONFIG_BT_NIMBLE_TASK_STACK_SIZE=4096
# Core pinning - BLE on Core 1, WiFi on Core 0 (required, no "unpinned" option)
CONFIG_BT_NIMBLE_PINNED_TO_CORE_1=y
# Security - Just Works pairing with bonding
CONFIG_BT_NIMBLE_SM_LEGACY=y
CONFIG_BT_NIMBLE_SM_SC=y
# Debug logging for BLE
CONFIG_BT_NIMBLE_LOG_LEVEL_WARNING=y

# WiFi + BLE Coexistence (required even on ESP32-S3)
CONFIG_ESP_COEX_SW_COEXIST_ENABLE=y

# Disable Ethernet
CONFIG_ETH_ENABLED=n

# Disable SPI Flash encryption/security
CONFIG_SECURE_FLASH_ENC_ENABLED=n
CONFIG_SECURE_BOOT=n
CONFIG_SECURE_BOOT_SIGNED_BINARIES=n
CONFIG_SECURE_BOOT_BUILD_SIGNED_BINARIES=n

# Disable file systems we don't use
CONFIG_SPIFFS_ENABLED=n
CONFIG_FATFS_ENABLED=n

# Disable unused app protocols
CONFIG_ESP_HTTP_CLIENT_ENABLE=n
CONFIG_ESP_HTTP_SERVER_ENABLE=n
CONFIG_ESP_WEBSOCKET_CLIENT_ENABLE=n
CONFIG_MQTT_ENABLED=n
CONFIG_COAP_ENABLED=n
